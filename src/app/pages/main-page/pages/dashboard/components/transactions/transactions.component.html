<div class="top">
    <div>
        <svg-icon src="assets/svg/transactions.svg"></svg-icon>
        Transactions
    </div>
    <div class="wrap-input">
        <div class="wrap-input__icon">
            <svg-icon src="assets/svg/search.svg"></svg-icon>
        </div>
        <input
            placeholder="Search"
            type="text"
            #inputRef
            [disabled]="isFilterByGroups"
            (input)="onInputEvent($event)">

        @if (inputRef.value) {
            <div
                class="wrap-input__clear"
                (click)="clearInputEvent()">
                <svg-icon src="assets/svg/plus.svg"></svg-icon>
            </div>
        }
        
    </div>
</div>

<div class="filters">
    <mat-checkbox 
        (change)="onFilterGroupsChange($event)"
        [checked]="isFilterByGroups">
        {{ isFilterByGroups ? '' : 'Filter by groups' }}
    </mat-checkbox>
    @if (isFilterByGroups) {
        <mat-form-field>
            <mat-label>Groups</mat-label>
            <mat-select
                (valueChange)="onSelectValueChange($event)"
                multiple>
                @for (group of groups; track group.title) {
                    <mat-option
                        class="group-option"
                        [value]="group.keys.join()">
                        <div>{{ group.emoji }}</div>
                        <div>{{ group.title }}</div>
                    </mat-option>
                }
            </mat-select>
        </mat-form-field>
    }
    
</div>

<table class="transactions">
    <thead>
        <tr>
            <th [class.sort-active]="sortByValue === SortBy.Payment">
                <span (click)="onSortByEvent(SortBy.Payment)">Payment</span>
                <svg-icon 
                    src="assets/svg/sort-up.svg" 
                    [class.rotate]="!isAscSortDirection">
                </svg-icon>
            </th>
            <th
                class="date-th"
                [class.sort-active]="sortByValue === SortBy.Date">
                <span (click)="onSortByEvent(SortBy.Date)">Date</span>
                <svg-icon 
                    src="assets/svg/sort-up.svg" 
                    [class.rotate]="!isAscSortDirection">
                </svg-icon>
            </th>
            <th class="status-th">
                Status
                <svg-icon 
                    src="assets/svg/sort-up.svg" 
                    [class.rotate]="!isAscSortDirection">
                </svg-icon>
            </th>
            <th
                class="amount-th"
                [class.sort-active]="sortByValue === SortBy.Amount" >
                <span (click)="onSortByEvent(SortBy.Amount)">
                    Amount
                </span>
                <svg-icon 
                    src="assets/svg/sort-up.svg" 
                    [class.rotate]="!isAscSortDirection">
                </svg-icon>
            </th>
        </tr>
    </thead>
    <tbody>
        @for (
            transaction of transactions; 
            track transaction.id
        ) {
            <tr>
                <th>{{ transaction.description }}</th>
                <td>{{ transaction.time * 1000 | date: 'MMM d, y â€¢ HH:mm' }}</td>
                @if (transaction.amount < 0) {
                    <td>Sent</td>
                } @else {
                    <td>Received</td>
                }
                <td 
                    class="amount"
                    [class.sent]="transaction.amount < 0">
                    {{ transaction.amount / 100 }} UAH
                    @if (transaction.cashbackAmount > 0) {
                        <span class="cashback">+{{ transaction.cashbackAmount / 100 }} UAH</span>
                    }
                </td>
            </tr>
        }
    </tbody>
</table>