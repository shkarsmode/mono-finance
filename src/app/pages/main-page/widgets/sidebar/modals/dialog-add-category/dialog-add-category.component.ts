import { LiveAnnouncer } from '@angular/cdk/a11y';
import { ENTER } from '@angular/cdk/keycodes';
import { ChangeDetectionStrategy, Component, ElementRef, Inject, OnInit, ViewChild, inject } from '@angular/core';
import { FormControl } from '@angular/forms';
import { MatAutocompleteSelectedEvent } from '@angular/material/autocomplete';
import { MatChipInputEvent } from '@angular/material/chips';
import { MAT_DIALOG_DATA, MatDialogRef } from '@angular/material/dialog';
import { MatSelect } from '@angular/material/select';
import { Observable, map, startWith } from 'rxjs';

@Component({
    selector: 'app-dialog-add-category',
    templateUrl: './dialog-add-category.component.html',
    styleUrl: './dialog-add-category.component.scss',
    changeDetection: ChangeDetectionStrategy.OnPush,
})
export class DialogAddCategoryComponent implements OnInit {
    public keys: string[] = [];
    public allKeys: string[] = [];
    public keysCtrl = new FormControl('');
    public emojis: string[] = emojisArray;
    public filteredKeys: Observable<string[]>;
    public separatorKeysCodes: number[] = [ENTER];

    @ViewChild('emojiRef', { static: true }) emojiSelect: MatSelect;
    @ViewChild('titleRef', { static: true }) titleRef: ElementRef<HTMLInputElement>;
    @ViewChild('keysInput') keysInput: ElementRef<HTMLInputElement>;

    announcer = inject(LiveAnnouncer);

    constructor(
        @Inject(MAT_DIALOG_DATA)
        public data: {
            transactions: string[];
            editGroupData: { keys: string[]; emoji: string; title: string };
        },
        private readonly dialog: MatDialogRef<void>
    ) {
        this.filteredKeys = this.keysCtrl.valueChanges.pipe(
            startWith(null),
            map((fruit: string | null) =>
                fruit ? this.filter(fruit) : this.allKeys.slice()
            )
        );

        this.allKeys = data.transactions;
    }

    public ngOnInit(): void {
        this.setInitialValueIfExists();
    }

    private setInitialValueIfExists(): void {
        if (!this.data.editGroupData) return;

        const { keys, emoji, title } = this.data.editGroupData;
        this.keys = keys;
        this.emojiSelect.writeValue(emoji);
        this.titleRef.nativeElement.value = title;
    }

    public add(event: MatChipInputEvent): void {
        const value = (event.value || '').trim();

        if (value) {
            this.keys.push(value);
        }

        event.chipInput!.clear();

        this.keysCtrl.setValue(null);
    }

    public remove(fruit: string): void {
        const index = this.keys.indexOf(fruit);

        if (index >= 0) {
            this.keys.splice(index, 1);

            this.announcer.announce(`Removed ${fruit}`);
        }
    }

    public selected(event: MatAutocompleteSelectedEvent): void {
        this.keys.push(event.option.viewValue);
        this.keysInput.nativeElement.value = '';
        this.keysCtrl.setValue(null);
    }

    public create(): void {
        const data = {
            keys: this.keys,
            emoji: this.emojiSelect.value,
            title: this.titleRef.nativeElement.value,
            amount: 0,
        };
        if (!data.keys.length || !data.emoji || !data.title) {
            return;
        }

        this.dialog.close(data);
    }

    private filter(value: string): string[] {
        const filterValue = value.toLowerCase();
        console.log(this.allKeys);

        return this.allKeys.filter((key) =>
            key.toLowerCase().includes(filterValue)
        );
    }
}

const emojisArray = [
    'ğŸ',
    'ğŸš',
    'â›½',
    'ğŸŸ',
    'ğŸ',
    'ğŸš•',
    'ğŸ›»',
    'ğŸ’ˆ',
    'ğŸ“',
    'ğŸ®',
    'ğŸ±',
    'ğŸ‡ºğŸ‡¦',
    'ğŸ˜ƒ',
    'ğŸ˜„',
    'ğŸ˜',
    'ğŸ˜†',
    'ğŸ˜…',
    'ğŸ˜‚',
    'ğŸ¤£',
    'ğŸ˜­',
    'ğŸ˜‰',
    'ğŸ˜—',
    'ğŸ˜™',
    'ğŸ˜š',
    'ğŸ˜˜',
    'ğŸ¥°',
    'ğŸ˜',
    'ğŸ¤©',
    'ğŸ¥³',
    'ğŸ™ƒ',
    'ğŸ™‚',
    'ğŸ¥²',
    'ğŸ¥¹',
    'ğŸ˜‹',
    'ğŸ˜›',
    'ğŸ˜',
    'ğŸ˜œ',
    'ğŸ¤ª',
    'ğŸ˜‡',
    'ğŸ˜Š',
    'â˜ºï¸',
    'ğŸ˜³',
    'ğŸ¤¯',
    'ğŸ˜¬',
    'ğŸ˜“',
    'ğŸ˜',
    'ğŸ˜–',
    'ğŸ˜£',
    'ğŸ˜©',
    'ğŸ˜«',
    'ğŸ˜µ',
    'ğŸŒ',
    'ğŸ« ',
    'ğŸ˜¶â€ğŸŒ«ï¸',
    'ğŸ¥´',
    'ğŸ¥µ',
    'ğŸ¥¶',
    'ğŸ¤¢',
    'ğŸ¤®',
    'ğŸ¤§',
    'ğŸ¤’',
    'ğŸ¤•',
    'ğŸ˜·',
    'ğŸ¤ ',
    'ğŸ¤‘',
    'ğŸ˜',
    'ğŸ¤“',
    'ğŸ¥¸',
    'ğŸ¤¥',
    'ğŸ¤¡',
    'ğŸ‘»',
    'ğŸ’©',
    'ğŸ‘½',
    'ğŸ¤–',
    'ğŸƒ',
    'ğŸ˜ˆ',
    'ğŸ‘¿',
    'ğŸ‘¹',
    'ğŸ‘º',
    'ğŸ•³ï¸',
    'ğŸ‰',
    'ğŸŠ',
    'ğŸ™ˆ',
    'ğŸ™‰',
    'ğŸ™Š',
    'ğŸ˜º',
    'ğŸ˜¸',
    'ğŸ˜¹',
    'ğŸ˜»',
    'ğŸ˜¼',
    'ğŸ˜½',
    'ğŸ™€',
    'ğŸ˜¿',
    'ğŸ˜¾',
    'â¤ï¸',
    'ğŸ§¡',
    'ğŸ’›',
    'ğŸ’š',
    'ğŸ’™',
    'ğŸ’œ',
    'ğŸ¤',
    'ğŸ–¤',
    'ğŸ¤',
    'â™¥ï¸',
    'ğŸ’˜',
    'ğŸ’',
    'ğŸ’–',
    'ğŸ’—',
    'ğŸ’“',
    'ğŸ’',
    'ğŸ‘¥',
    'ğŸ‘¤',
    'ğŸ—£ï¸',
    'ğŸ‘£',
    'ğŸ§ ',
    'ğŸ«€',
    'ğŸ«',
    'ğŸ©¸',
    'ğŸ¦ ',
    'ğŸ¦·',
    'ğŸ¦´',
    'â˜ ï¸',
    'ğŸ’€',
    'ğŸ‘€',
    'ğŸ‘ï¸',
    'ğŸ‘„',
    'ğŸ«¦',
    'ğŸ‘…',
    'ğŸ‘ƒ',
    'ğŸ‘‚',
    'ğŸ¦»',
    'ğŸ¦¶',
    'ğŸ¦µ',
    'ğŸ¦¿',
    'ğŸ¦¾',
    'ğŸ’ª',
    'ğŸ‘',
    'ğŸ‘',
    'ğŸ‘',
    'ğŸ«¶',
    'ğŸ¤',
    'ğŸ«°',
    'ğŸ¤™',
    'ğŸ¤Œ',
    'ğŸ¤',
    'ğŸ‘Œ',
    'ğŸ–•',
    'â˜ï¸',
    'ğŸ‘†',
    'ğŸ‘‡',
    'ğŸ‘‰',
    'ğŸ‘ˆ',
    'ğŸ«µ',
    'âœï¸',
    'ğŸ¤³',
    'ğŸ™',
    'ğŸ’…',
    'â¤ï¸',
    'ğŸ§¡',
    'ğŸ’›',
    'ğŸ’š',
    'ğŸ’™',
    'ğŸ’œ',
    'ğŸ¤',
    'ğŸ–¤',
    'ğŸ¤',
    'ğŸ”´',
    'ğŸŸ ',
    'ğŸŸ¡',
    'ğŸŸ¢',
    'ğŸ”µ',
    'ğŸŸ£',
    'ğŸŸ¤',
    'âš«',
    'âšª',
    'ğŸŸ¥',
    'ğŸŸ§',
    'ğŸŸ¨',
    'ğŸŸ©',
    'ğŸŸ¦',
    'ğŸŸª',
    'ğŸŸ«',
    'â¬›',
    'â¬œ',
    'â™ˆ',
    'â™‰',
    'â™Š',
    'â™‹',
    'â™Œ',
    'â™',
    'â™',
    'â™',
    'â™',
    'â™‘',
    'â™’',
    'â™“',
    'â›',
    'â™€ï¸',
    'â™‚ï¸',
    'âš§ï¸',
    'ğŸ”»',
    'ğŸ”º',
    'â•',
    'â—',
    'â”',
    'â“',
    'â‰ï¸',
    'â€¼ï¸',
    'â­•',
    'âŒ',
    'ğŸš«',
    'ğŸš³',
    'ğŸš­',
    'ğŸš¯',
    'ğŸš±',
    'ğŸš·',
    'ğŸ“µ',
    'ğŸ”',
    'ğŸ”•',
    'ğŸ”‡',
    'ğŸ…°ï¸',
    'ğŸ†',
    'ğŸ…±ï¸',
    'ğŸ…¾ï¸',
    'ğŸ†‘',
    'ğŸ†˜',
    'ğŸ›‘',
    'â›”',
    'ğŸ“›',
    'â™¨ï¸',
    'ğŸ‰',
    'ãŠ™ï¸',
    'ãŠ—ï¸',
    'ğŸˆ´',
    'ğŸˆµ',
    'ğŸˆ¹',
    'ğŸˆ²',
    'ğŸ‰‘',
    'ğŸˆ¶',
    'ğŸˆš',
    'ğŸˆ¸',
    'ğŸˆº',
    'ğŸˆ·ï¸',
    'ğŸ”¶',
    'ğŸ”¸',
    'ğŸ”†',
    'ğŸ”…',
    'âœ´ï¸',
    'ğŸ†š',
    'ğŸ¦',
    'ğŸ“¶',
    'ğŸ”',
    'ğŸ”½',
    'â¬',
    'â¸ï¸',
    'â¹ï¸',
    'âºï¸',
    'âï¸',
    'ğŸ“´',
    'ğŸ“³',
    'ğŸ“²',
    'ğŸ”ˆ',
    'ğŸ”‰',
    'ğŸ”Š',
    'ğŸ¼',
    'ğŸµ',
    'ğŸ¶',
    'â˜¢ï¸',
    'â˜£ï¸',
    'âš ï¸',
    'ğŸš¸',
    'âšœï¸',
    'ğŸ”±',
    'ã€½ï¸',
    'ğŸ”°',
    'âœ³ï¸',
    'â‡ï¸',
    'â™»ï¸',
    'ğŸ’±',
    'ğŸ’²',
    'ğŸ’¹',
    'ğŸˆ¯',
    'â',
    'âœ…',
    'âœ”ï¸',
    'â˜‘ï¸',
    'â¬†ï¸',
    'â†—ï¸',
    'â¡ï¸',
    'â†˜ï¸',
    'â¬‡ï¸',
    'â†™ï¸',
    'â¬…ï¸',
    'â†–ï¸',
    'â†•ï¸',
    'â†”ï¸',
    'â†©ï¸',
    'â†ªï¸',
    'â¤´ï¸',
    'â¤µï¸',
    'ğŸ”ƒ',
    'ğŸ”„',
    'ğŸ”™',
    'ğŸ”›',
    'ğŸ”',
    'ğŸ”š',
    'ğŸ”œ',
    'ğŸ†•',
    'ğŸ†“',
    'ğŸ†™',
    'ğŸ†—',
    'ğŸ†’',
    'ğŸ†–',
    'ğŸ…¿ï¸',
    'ğŸˆ',
    'ğŸˆ‚ï¸',
    'ğŸˆ³',
    'ğŸ”£',
    'ğŸ”¤',
    'ğŸ” ',
    'ğŸ”¡',
    'ğŸ”¢',
    '#ï¸âƒ£',
    '*ï¸âƒ£',
    '0ï¸âƒ£',
    '1ï¸âƒ£',
    '2ï¸âƒ£',
    '3ï¸âƒ£',
    '4ï¸âƒ£',
    '5ï¸âƒ£',
    '6ï¸âƒ£',
    '7ï¸âƒ£',
    '8ï¸âƒ£',
    '9ï¸âƒ£',
    'ğŸ”Ÿ',
    'ğŸ’ ',
    'ğŸ”·',
    'ğŸ”¹',
    'ğŸŒ',
    'ğŸ§',
    'â“‚ï¸',
    'ğŸš¾',
    'ğŸš»',
    'ğŸš¹',
    'ğŸšº',
    'â™¿',
    'ğŸš¼',
    'ğŸ›—',
    'ğŸš®',
    'ğŸš°',
    'ğŸ›‚',
    'ğŸ›ƒ',
    'ğŸ›„',
    'ğŸ›…',
    'ğŸ’Ÿ',
    'âš›ï¸',
    'ğŸ›',
    'ğŸ•‰ï¸',
    'â˜¸ï¸',
    'â˜®ï¸',
    'â˜¯ï¸',
    'â˜ªï¸',
    'âœï¸',
    'â˜¦ï¸',
    'âœ¡ï¸',
    'ğŸ”¯',
    'ğŸ•',
    'â™¾ï¸',
    'ğŸ†”',
    'âš•ï¸',
    'âœ–ï¸',
    'â•',
    'â–',
    'â—',
    'ğŸŸ°',
    'â°',
    'â¿',
    'ã€°ï¸',
    'Â©ï¸',
    'Â®ï¸',
    'â„¢ï¸',
    'â™¥ï¸',
    'â™¦ï¸',
    'â™£ï¸',
    'â™ ï¸',
    'ğŸ”˜',
    'ğŸ”³',
    'â—¼ï¸',
    'â—¾',
    'â–ªï¸',
    'ğŸ”²',
    'â—»ï¸',
    'â—½',
    'â–«ï¸',
    'ğŸ’­',
    'ğŸ—¯ï¸',
    'ğŸ’¬',
    'ğŸ—¨ï¸',
    'ğŸ‘ï¸â€ğŸ—¨ï¸',
    'ğŸ“±',
    'â˜ï¸',
    'ğŸ“',
    'ğŸ“Ÿ',
    'ğŸ“ ',
    'ğŸ”Œ',
    'ğŸ”‹',
    'ğŸª«',
    'ğŸ–²ï¸',
    'ğŸ’½',
    'ğŸ’¾',
    'ğŸ’¿',
    'ğŸ“€',
    'ğŸ–¥ï¸',
    'ğŸ’»',
    'âŒ¨ï¸',
    'ğŸ–¨ï¸',
    'ğŸ–±ï¸',
    'ğŸª™',
    'ğŸ’¸',
    'ğŸ’µ',
    'ğŸ’´',
    'ğŸ’¶',
    'ğŸ’·',
    'ğŸ’³',
    'ğŸ’°',
    'ğŸ§¾',
    'ğŸ§®',
    'âš–ï¸',
    'ğŸ›’',
    'ğŸ›ï¸',
    'ğŸ•¯ï¸',
    'ğŸ’¡',
    'ğŸ”¦',
    'ğŸ®',
    'ğŸ§±',
    'ğŸªŸ',
    'ğŸª',
    'ğŸšª',
    'ğŸª‘',
    'ğŸ›ï¸',
    'ğŸ›‹ï¸',
    'ğŸš¿',
    'ğŸ›',
    'ğŸš½',
    'ğŸ§»',
    'ğŸª ',
    'ğŸ§¸',
    'ğŸª†',
    'ğŸ§·',
    'ğŸª¢',
    'ğŸ§¹',
    'ğŸ§´',
    'ğŸ§½',
    'ğŸ§¼',
    'ğŸª¥',
    'ğŸª’',
    'ğŸ§º',
    'ğŸ§¦',
    'ğŸ§¤',
    'ğŸ§£',
    'ğŸ‘–',
    'ğŸ‘•',
    'ğŸ½',
    'ğŸ‘š',
    'ğŸ‘”',
    'ğŸ‘—',
    'ğŸ‘˜',
    'ğŸ¥»',
    'ğŸ©±',
    'ğŸ‘™',
    'ğŸ©³',
    'ğŸ©²',
    'ğŸ§¥',
    'ğŸ¥¼',
    'ğŸ¦º',
    'â›‘ï¸',
    'ğŸª–',
    'ğŸ“',
    'ğŸ©',
    'ğŸ‘’',
    'ğŸ§¢',
    'ğŸ‘‘',
    'ğŸ’',
    'ğŸ‘',
    'ğŸ‘›',
    'ğŸ‘œ',
    'ğŸ’¼',
    'ğŸ§³',
    'â˜‚ï¸',
    'ğŸŒ‚',
    'ğŸ’',
    'ğŸ’',
    'ğŸ’„',
    'ğŸ‘ ',
    'ğŸ‘Ÿ',
    'ğŸ‘',
    'ğŸ¥¿',
    'ğŸ©´',
    'ğŸ‘¡',
    'ğŸ‘¢',
    'ğŸ¥¾',
    'ğŸ‘“',
    'ğŸ•¶ï¸',
    'ğŸ¦¯',
    'ğŸ¥½',
    'âš—ï¸',
    'ğŸ§«',
    'ğŸ§ª',
    'ğŸŒ¡ï¸',
    'ğŸ§¬',
    'ğŸ’‰',
    'ğŸ’Š',
    'ğŸ©¹',
    'ğŸ©º',
    'ğŸ©»',
    'ğŸ”­',
    'ğŸ”¬',
    'ğŸ“¡',
    'ğŸ›°ï¸',
    'ğŸ§¯',
    'ğŸª“',
    'ğŸªœ',
    'ğŸª£',
    'ğŸª',
    'ğŸ§²',
    'ğŸ§°',
    'ğŸ—œï¸',
    'ğŸ”©',
    'ğŸª›',
    'ğŸªš',
    'ğŸ”§',
    'ğŸ”¨',
    'âš’ï¸',
    'ğŸ› ï¸',
    'â›ï¸',
    'âš™ï¸',
    'ğŸ”—',
    'â›“ï¸',
    'ğŸ“',
    'ğŸ–‡ï¸',
    'ğŸ“',
    'ğŸ“',
    'âœ‚ï¸',
    'ğŸ“Œ',
    'ğŸ“',
    'ğŸ—‘ï¸',
    'ğŸ–Œï¸',
    'ğŸ–ï¸',
    'ğŸ–Šï¸',
    'ğŸ–‹ï¸',
    'âœ’ï¸',
    'âœï¸',
    'ğŸ“',
    'ğŸ“’',
    'ğŸ“”',
    'ğŸ“•',
    'ğŸ““',
    'ğŸ“—',
    'ğŸ“˜',
    'ğŸ“™',
    'ğŸ“š',
    'ğŸ“–',
    'ğŸ”–',
    'ğŸ—’ï¸',
    'ğŸ“„',
    'ğŸ“ƒ',
    'ğŸ“‹',
    'ğŸ“‡',
    'ğŸ“‘',
    'ğŸ—ƒï¸',
    'ğŸ—„ï¸',
    'ğŸ—‚ï¸',
    'ğŸ“‚',
    'ğŸ“',
    'ğŸ“°',
    'ğŸ—ï¸',
    'ğŸ“Š',
    'ğŸ“ˆ',
    'ğŸ“‰',
    'ğŸª§',
    'ğŸªª',
    'ğŸ·ï¸',
    'ğŸ“¦',
    'ğŸ“«',
    'ğŸ“ª',
    'ğŸ“¬',
    'ğŸ“­',
    'ğŸ“®',
    'âœ‰ï¸',
    'ğŸ“§',
    'ğŸ“©',
    'ğŸ“¨',
    'ğŸ’Œ',
    'ğŸ“¤',
    'ğŸ“¥',
    'ğŸ—³ï¸',
    'â±ï¸',
    'ğŸ•›',
    'ğŸ•§',
    'ğŸ•',
    'ğŸ•œ',
    'ğŸ•‘',
    'ğŸ•',
    'ğŸ•’',
    'ğŸ•',
    'ğŸ•“',
    'ğŸ•Ÿ',
    'ğŸ•”',
    'ğŸ• ',
    'ğŸ••',
    'ğŸ•¡',
    'ğŸ•–',
    'ğŸ•¢',
    'ğŸ•—',
    'ğŸ•£',
    'ğŸ•˜',
    'ğŸ•¤',
    'ğŸ•™',
    'ğŸ•¥',
    'ğŸ•š',
    'ğŸ•¦',
    'âŒ›',
    'â³',
    'ğŸ•°ï¸',
    'âŒš',
    'â²ï¸',
    'â°',
    'ğŸ—“ï¸',
    'ğŸ“…',
    'ğŸ“†',
    'ğŸ›ï¸',
    'ğŸ””',
    'ğŸ“¯',
    'ğŸ“¢',
    'ğŸ“£',
    'ğŸ”',
    'ğŸ”',
    'ğŸ”®',
    'ğŸ§¿',
    'ğŸª¬',
    'ğŸ“¿',
    'ğŸº',
    'âš±ï¸',
    'âš°ï¸',
    'ğŸª¦',
    'ğŸš¬',
    'ğŸ’£',
    'ğŸª¤',
    'ğŸ“œ',
    'âš”ï¸',
    'ğŸ—¡ï¸',
    'ğŸ›¡ï¸',
    'ğŸ—ï¸',
    'ğŸ”‘',
    'ğŸ”',
    'ğŸ”',
    'ğŸ”’',
    'ğŸ”“',
];